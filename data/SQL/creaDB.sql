PRAGMA foreign_keys = ON;

-- Tables principales :

DROP TABLE IF EXISTS ARTISTE;
CREATE TABLE ARTISTE(
    idArtiste INTEGER PRIMARY KEY AUTOINCREMENT,
    nomA TEXT NOT NULL,
    prenomA TEXT NOT NULL,
    descriptionA TEXT NOT NULL,
    nbAuditeurs INTEGER NOT NULL DEFAULT 0
);

DROP TABLE IF EXISTS ALBUM;
CREATE TABLE ALBUM(
    idAlbum INTEGER PRIMARY KEY AUTOINCREMENT,
    idArtiste INTEGER NOT NULL,
    nomAlbum TEXT NOT NULL,
    releaseYear INTEGER NOT NULL,
    FOREIGN KEY (idArtiste) REFERENCES ARTISTE(idArtiste)
);

DROP TABLE IF EXISTS IMAGE;
CREATE TABLE IMAGE(
    idImage INTEGER PRIMARY KEY AUTOINCREMENT,
    image TEXT NOT NULL
);

DROP TABLE IF EXISTS MUSIQUE;
CREATE TABLE MUSIQUE (
    idMusique INTEGER PRIMARY KEY AUTOINCREMENT,
    idAlbum INTEGER,
    nomMusque TEXT NOT NULL,
    releaseYear INTEGER NOT NULL,
    nbVues INTEGER NOT NULL DEFAULT 0,
    FOREIGN KEY (idAlbum) REFERENCES ALBUM(idAlbum)
);

DROP TABLE IF EXISTS UTILISATEUR;
CREATE TABLE UTILISATEUR(
    idUser INTEGER PRIMARY KEY AUTOINCREMENT,
    pseudo TEXT NOT NULL,
    mdp TEXT NOT NULL,
    email TEXT NOT NULL,
    descriptionU TEXT NOT NULL,
    roleU TEXT NOT NULL DEFAULT 'USER',
    idImage INTEGER DEFAULT 1,
    FOREIGN KEY (idImage) REFERENCES IMAGE(idImage)
);

DROP TABLE IF EXISTS PLAYLIST;
CREATE TABLE PLAYLIST(
    idPlaylist INTEGER PRIMARY KEY AUTOINCREMENT,
    idUser INTEGER NOT NULL,
    nomPlaylist TEXT NOT NULL,
    releaseYear INTEGER NOT NULL,
    FOREIGN KEY (idUser) REFERENCES UTILISATEUR(idUser)
);

DROP TABLE IF EXISTS GENRE_MUSICAL;
CREATE TABLE GENRE_MUSICAL(
    idGenre INTEGER PRIMARY KEY AUTOINCREMENT,
    nomGenre TEXT NOT NULL
);


-- Tables de joINTEGERures :

DROP TABLE IF EXISTS CREER;
CREATE TABLE CREER(
    idUser INTEGER NOT NULL,
    idPlaylist INTEGER NOT NULL,
    PRIMARY KEY (idUser, idPlaylist),
    FOREIGN KEY (idUser) REFERENCES UTILISATEUR(idUser),
    FOREIGN KEY (idPlaylist) REFERENCES PLAYLIST(idPlaylist)
);

DROP TABLE IF EXISTS CONTENIR;
CREATE TABLE CONTENIR(
    idPlaylist INTEGER NOT NULL,
    idMusique INTEGER NOT NULL,
    PRIMARY KEY (idPlaylist, idMusique),
    FOREIGN KEY (idPlaylist) REFERENCES PLAYLIST(idPlaylist),
    FOREIGN KEY (idMusique) REFERENCES MUSIQUE(idMusique)
);

DROP TABLE IF EXISTS COMPOSER;
CREATE TABLE COMPOSER(
    idMusique INTEGER NOT NULL,
    idArtiste INTEGER NOT NULL,
    PRIMARY KEY (idMusique, idArtiste),
    FOREIGN KEY (idMusique) REFERENCES MUSIQUE(idMusique),
    FOREIGN KEY (idArtiste) REFERENCES ARTISTE(idArtiste)
);

DROP TABLE IF EXISTS APPRECIER;
CREATE TABLE APPRECIER(
    idUser INTEGER NOT NULL,
    idMusique INTEGER NOT NULL,
    PRIMARY KEY (idUser, idMusique),
    FOREIGN KEY (idUser) REFERENCES UTILISATEUR(idUser),
    FOREIGN KEY (idMusique) REFERENCES MUSIQUE(idMusique)
);

DROP TABLE IF EXISTS ASSOCIER;
CREATE TABLE ASSOCIER(
    idMusique INTEGER NOT NULL,
    idImage INTEGER NOT NULL,
    PRIMARY KEY (idMusique, idImage),
    FOREIGN KEY (idMusique) REFERENCES MUSIQUE(idMusique),
    FOREIGN KEY (idImage) REFERENCES IMAGE(idImage)
);

DROP TABLE IF EXISTS POSSEDER;
CREATE TABLE POSSEDER(
    idMusique INTEGER NOT NULL,
    idAlbum INTEGER NOT NULL,
    PRIMARY KEY (idMusique, idAlbum),
    FOREIGN KEY (idMusique) REFERENCES MUSIQUE(idMusique),
    FOREIGN KEY (idAlbum) REFERENCES ALBUM(idAlbum)
);

DROP TABLE IF EXISTS CLASSER;
CREATE TABLE CLASSER(
    idMusique INTEGER NOT NULL,
    idGenre INTEGER NOT NULL,
    PRIMARY KEY (idMusique, idGenre),
    FOREIGN KEY (idMusique) REFERENCES MUSIQUE(idMusique),
    FOREIGN KEY (idGenre) REFERENCES GENRE_MUSICAL(idGenre)
);

DROP TABLE IF EXISTS LIER;
CREATE TABLE LIER(
    idAlbum INTEGER NOT NULL,
    idImage INTEGER NOT NULL,
    PRIMARY KEY (idAlbum, idImage),
    FOREIGN KEY (idAlbum) REFERENCES ALBUM(idAlbum),
    FOREIGN KEY (idImage) REFERENCES IMAGE(idImage)
);

DROP TABLE IF EXISTS REPRESENTER;
CREATE TABLE REPRESENTER(
    idArtiste INTEGER NOT NULL,
    idImage INTEGER NOT NULL,
    PRIMARY KEY (idArtiste, idImage),
    FOREIGN KEY (idArtiste) REFERENCES ARTISTE(idArtiste),
    FOREIGN KEY (idImage) REFERENCES IMAGE(idImage)
);

DROP TABLE IF EXISTS REALISER;
CREATE TABLE REALISER(
    idArtiste INTEGER NOT NULL,
    idAlbum INTEGER NOT NULL,
    PRIMARY KEY (idArtiste, idAlbum),
    FOREIGN KEY (idArtiste) REFERENCES ARTISTE(idArtiste),
    FOREIGN KEY (idAlbum) REFERENCES ALBUM(idAlbum)
);

DROP TABLE IF EXISTS APPARTENIR;
CREATE TABLE APPARTENIR(
    idAlbum INTEGER NOT NULL,
    idGenre INTEGER NOT NULL,
    PRIMARY KEY (idAlbum, idGenre),
    FOREIGN KEY (idAlbum) REFERENCES ALBUM(idAlbum),
    FOREIGN KEY (idGenre) REFERENCES GENRE_MUSICAL(idGenre)
);


INSERT INTO IMAGE (idImage, image) VALUES (0, 'defaultPDP.png');
























